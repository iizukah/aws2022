---
marp: true
theme: gaia
headingDivider: 5
math: katex
paginate: true
---

# AWS Well-Architected フレームワーク

## 要約

> AWS Well-Architected フレームワークの目的は、AWSでシステムを構築する際の選択肢の長所と短所をお客様が理解できるように支援することです。効率がよく、費用対効果が高く、安全で信頼のおけるクラウド対応システムを設計して運用するために、アーキテクチャに関するベストプラクティスをこのフレームワークにしたがって学ぶことができます。

## はじめに

* AWS Well-Architected フレームワーク(AWSWAF)の目的：AWSのシステム構築時における選択肢の長所と短所の理解支援。アーキテクチャに関するベストプラクティスを学ぶことができる。

### 定義

* AWS WAF：アーキテクチャを評価するための一貫したベストプラクティスや、アーキテクチャがAWSのベストプラクティスにどれだけ準拠しているかを評価するための質問を提供。

---

* 用語
  * コンポーネント:ビジネス要件を連携して実現させるコード、構成、AWSリソース。
  * ワークロード:ビジネス価値を実現する一連のコンポーネント。
  * マイルストーン:アーキテクチャにおける設計、テスト、稼働、本番という製品のライフサイクル全体を通した進化における重要な変更記録。
  * テクノロジーポートフォリオ:ビジネスの運用に必要なワークロードの集合体。

---

* 5つの柱が基本
  * 運用上の優秀性:開発をサポートし、ワークロードを効率的に実行し、運用に関する洞察を得て、ビジネス価値をもたらすためのサポートプロセスと手順を継続的に改善する能力。
  * セキュリティ:データ、システム、資産を保護して、クラウドテクノロジーを活用してセキュリティを強化する能力。
  * 信頼性:意図した機能を期待どおりに正しく一貫して実行するワークロードの能力。ワークロードのライフサイクル全体を通じてワークロードを運用およびテストする能力も含む。

---

* 5つの柱が基本(Cont.)
  * パフォーマンス効率:システムの要件を満たすためにコンピューティングリソースを効率的に使用し、要求の変化とテクノロジーの進化に対してもその効率性を維持する能力。
  * コスト最適化:最も低い価格でシステムを運用してビジネス価値を実現する能力。

* ワークロード設計時、5本の柱間でトレードオフを行う。
  * 例1:信頼性を犠牲にしてコスト最適化を行う。
  * 例2:信頼性を最適化するためにコストを払う。
  * 通常、セキュリティと運用上の優秀性は他の柱とトレードオフ不可。

## 一般的な設計の原則

* Stop guessing your capacity needs(キャパシティニーズの推測が不要):必要な分のみキャパシティを使用し、自動的にスケールアップまたはスケールダウン可能。
* Test systems at production scale(本稼働スケールでシステムをテスト):オンデマンドで本稼働規模のテスト環境を作成し、テストが完了したらリソースを削除可能。
* Automate to make architectural experimentation easier(⾃動化によってアーキテクチャでの実験が容易に): 自動化により、低コストでワークロードを作成、レプリケート可能であり、手作業による負担を回避可能。

---

* Allow for evolutionary architectures(アーキテクチャの進化が可能に):自動化しオンデマンドでテスト可能なので、設計変更リスクを軽減可能。システムを時間とともに進化させることができる。
* Drive architectures using data(データに基づいてアーキテクチャを駆動): アーキテクチャの選択がワークロードの動作に与える影響に関するデータを収集可能。これにより、ワークロードを改善する方法について、事実に基づいた意思決定を⾏うことができる。
* Improve through game days(ゲームデーを利用して改善する):ゲームデーをスケジュールし、本番環境のイベントをシミュレートすることで、パフォーマンスをテストする。cf. game day: <https://wa.aws.amazon.com/wellarchitected/2020-07-02T19-33-23/wat.concept.gameday.en.html>

## フレームワークの5本の柱

### 運用上の優秀性

* 運用上の優秀性:以下の能力を含む。
  * 開発をサポート。
  * ワークロードを効率的に実行。
  * 運用に関するインサイトを獲得。
  * ビジネス価値をもたらすサポートプロセスと手順の継続的改善。

> The Operational Excellence pillar includes the ability to support development and run workloads effectively, gain insight into their operations, and to continuously improve supporting processes and procedures to deliver business value.

#### 設計の原則

* Perform operations as code(運用をコードとして実行する):アプリケーションコードのエンジニアリング原理を、環境全体に適用可能。ワークロード全体をコードとして定義・更新。人為的なミスを抑制し、イベントへの一貫性のある対応を実現できる。
* Make frequent, small, reversible changes(小規模かつ可逆的な変更を頻繁に行う): コンポーネントの定期更新可能なワークロードを設計する。失敗時にロールバック可能なように小規模な変更を行う。
* Refine operations procedures frequently(運用手順を頻繁に改善する): ワークロードを改良するときに、運用手順も改良する。定期的なゲームデーを計画する。

---

* Anticipate failure(障害を予想する): 「プレモータム(pre-mortem;事前検死)」演習を実施して、潜在的な障害原因の特定と排除・軽減をする。
* Learn from all operational failures(運用上の障害すべてから学ぶ):すべての運用イベントと障害から学んだ教訓を通じて、改善を促進する。

#### 定義

* 運用上の優秀性の4つのベストプラクティス領域
  * Organization(組織)
  * Prepare(準備)
  * Operate(運用)
  * Evolve(進化)

#### ベストプラクティス

##### 組織

* ビジネス成功のための優先度を設定するために、ワークロード全体、各チームの役割、共通のビジネス目標に関する理解を共有する必要がある。well-definedな優先度は、メリットを最大化する。
* 重点領域を決定するために、社内外の顧客ニーズを評価。ビジネス成果に必要なサポートについてきちんと理解できるようになる。
* 組織内のガイドラインや義務、およびコンプライアンス要件や業界標準などをしっかりと認識する。内部ガバナンスおよび外部コンプライアンス要件への変更を識別するメカニズムの存在を検証する。

---

* ビジネスに対する脅威 (ビジネスリスク、信頼性、セキュリティの脅威など) を評価する。
* リスクの影響を鑑みて、競合利益(competing interests)のトレードオフや代替アプローチを評価する。たとえば、新しい機能の市場投入までの時間を短縮することは、コストの最適化よりも重視される。メリットとリスクを管理し、重点領域を十分な情報に基づいて意思決定できるようにする。一部のリスクや選択肢は、一定期間許容される可能性があることにも留意。

---

* 各チームは自らの役割を理解する必要がある。諸々の権限を持つユーザを理解することによって、チームの利点を最大化できる。
* 組織内のすべてのチームとそのワークロードを1つの運用モデルによってサポートできると期待するのは合理的ではない。チームのニーズは、顧客・組織・チームメンバ、そしてワークロードの特徴によって形成されるためである。

---

* 各コンポーネントの所有者、および各プロセス・手順の定義担当者、およびそのパフォーマンスの責任者を特定する。

---

* 各コンポーネント、プロセス、手順のビジネス価値、それらのリソース配置理由・アクティビティ実行理由、所有権存在理由を理解することで、チームメンバーのアクションが明らかになる。チームメンバの責任を明確に定義することで、当該メンバーが適切に行動し、責任と所有権を識別するメカニズムを持つことができる。

---

* チームメンバーにサポートを提供することで、チームメンバーがより効果的に行動し、ビジネスの成果をサポートできるようにする。上級リーダーは、目標値設定・成功測定をする必要がある。上級リーダーは、ベストプラクティスの採用と組織の進化の協賛者、支持者、および推進者である必要がある。

---

* 学習を加速し、チームメンバーが関心と当事者意識を持ち続けるための実験を推奨する。チームは、新しいテクノロジーを採用し、需要と責任の変化をサポートするために、スキルセットを強化する必要がある。

---

* 外部規制・コンプライアンス要件がある場合は、 AWS クラウドコンプライアンス が提供するリソースを使用して、優先順位への影響を判断できるようにチームを教育する必要がある。
* Well-Architected フレームワークは学習、測定、改善に重点を置く。
* 開発前のアプローチ、本番稼働前のワークロードの状態、本番稼働中のワークロードの状態などを確認するのに役立つ AWS Well-Architected Tool を提供している。
* AWS Trusted Advisor は、最適化を推奨する中心的なチェックのセットへのアクセスを提供するツールで、優先順位を決定するのに役立つ。

---

* チームを教育するには、AWS Support (AWS ナレッジセンター、AWS ディスカッションフォーラム、AWS Support センター) および AWS ドキュメントが提供するリソースを使用する必要がある。
* また、AWS は Amazon Builders' Library の AWS の運用を通じて学んだベストプラクティスとパターンも共有している。
* AWS ブログと公式の AWS ポッドキャストでは、その他のさまざまな有益な情報を入手できる。
* AWS トレーニングと認定では、AWS の基礎に関するセルフペースデジタルコースを通じて無料のトレーニングを提供している。

---

* AWS Organizations などアカウント環境の一元管理ツールやサービスを使用して、運用モデルの管理を支援する必要がある。
* AWS Control Tower などのサービスでは、この管理機能が拡張されており、アカウントのセットアップに関する設計図 (運用モデルのサポート) を定義し、AWS Organizations を使用して進行中のガバナンスを適用し、新しいアカウントのプロビジョニングを自動化できる。
* AWS Managed Services、AWS Managed Services パートナー、または AWS パートナーネットワークのマネージドサービスプロバイダをはじめ、各種のマネージドサービスプロバイダは専門的な実装型のクラウド環境を提供し、セキュリティとコンプライアンスの要件、ビジネスの目標をサポートする。

---

> **OPS 1: 優先順位はどのように決定すればよいですか?**
> だれもが、ビジネスを成功させるうえで自分が果たす役割を理解する必要があります。リソースの優先順位を設定するため、共通の目標を設定してください。これにより、取り組みから得られるメリットが最大化されます。

---

> **OPS 2: ビジネスの成果をサポートするために、組織をどのように構築すればよいですか?**
> チームはビジネスの成果を達成するうえでの役割を理解する必要があります。チームは他のチームが成功するためのそれぞれの役割を理解し、自分たちのチームが成功するための他のチームの役割を理解し、目標を共有する必要があります。責任、所有権、意思決定方法、意思決定を行う権限を持つユーザーを理解することは、労力を集中的に投入し、チームの利点を最大化するのに役立ちます。

---

> **OPS 3: 組織の文化はビジネスの成果をどのようにサポートするのですか?**
> チームメンバーにサポートを提供することで、チームメンバーがより効果的に行動し、ビジネスの成果をサポートできるようにします。

##### 準備

* ワークロードと期待される動作を理解する必要がある。
* ワークロードを設計する際には、可観測性と問題調査への対応においてすべてのコンポーネントにわたって内部状態 (メトリクス、ログ、イベント、トレースなど) を理解するために必要な情報が送出されるようにする。
* ワークロードの稼働状態を監視し、結果にリスクがあった場合にそれを特定し、効果的な対応を可能にするために必要なテレメトリ(遠隔測定法)の開発を繰り返す。

---

* 本番環境への変化の流れを改善し、リファクタリング、品質に関する迅速なフィードバック、バグ修正を可能にするアプローチを採用する。
* 品質に関する迅速なフィードバックを提供し、望ましい結果をもたらさない変更から迅速に復旧できるようにするアプローチを採用する。
* 変更が失敗した場合の計画を立てて、必要な場合は迅速に対応し、変更をテストして検証できるようにする。
* 頻繁で小さく可逆的な変更に重点を置いて、変更の範囲を制限する。

---

* ワークロード、プロセス、手順、および従業員の運用準備状況を評価し、ワークロードに関連する運用上のリスクを理解する。一貫性のあるプロセス (手作業または自動化によるチェックリストを含む) を使用して、いつワークロードまたは変更を本稼働する準備ができるかを知る必要がある。
* クラウド上でコードとしてオペレーションを使用するとともに、安全に実験を行う機能を使用して、ワークロードや運用手順を開発し、障害に備えた練習を実施する。AWS CloudFormation を使用すると、運用管理のレベルが向上し、テンプレート化された整合性のあるサンドボックスの開発環境、テスト環境、本番環境を構築することができる。

---

> **OPS 4:  ワークロードの状態を理解できるようにするためには、ワークロードをどのように設計すればよいですか?**
> ワークロードを設計する際には、すべてのコンポーネント (メトリクス、ログ、トレースなど) にわたって内部状態を理解するために必要な情報が送出されるようにします。そうすることによって、適時に有用な返答を提供できるようになります。

---

> **OPS 5: どのように欠陥を減らし、修正を容易にして、本番環境への流れを改善するのですか?**
> リファクタリング、品質についてのすばやいフィードバック、バグ修正を可能にし、本番環境への変更のフローを改善するアプローチを採用します。これらにより、本番環境に採用される有益な変更を加速させ、デプロイされた問題を制限できます。またデプロイアクティビティを通じて挿入された問題をすばやく特定し、修復できます。

---

> **OPS 6: デプロイのリスクを軽減するにはどうすればよいですか?**
> 品質に関する迅速なフィードバックを提供し、望ましい結果をもたらさない変更から迅速に復旧できるようにするアプローチを採用します。このような手法を使用すると、変更のデプロイによって生じる問題の影響を軽減できます。

---

> **OPS 7: ワークロードをサポートする準備ができていることはどうすれば確認できますか?**
> ワークロード、プロセス、手順、従業員の運用準備状況を評価し、ワークロードに関連する運用上のリスクを理解するようにします。

##### 運用

* ワークロードの運用の成功は、ビジネスの成果と顧客の成果の達成度によって評価される。予想される成果を定義し、成功を評価する方法を決定する。また、ワークロードおよび運用が成功したかどうかを判断するための計算で使用するメトリクスを特定する。
* 運用上の優秀性を実現するには、運用上のイベントを効率的かつ効果的に管理する必要がある。計画的および予期しない運用イベントの両方に適用される。十分に把握しているイベントには既定のランブックを使用し、問題の調査および解決にはプレイブックを使用する。

---

* 対象 (顧客、ビジネス、開発者、運用など) に合わせたダッシュボードと通知によってワークロードの運用状況が伝えられるため、適切なアクションの実行や予測の管理、通常の運用が再開される時期の把握を行うことができる。
* CloudWatch またはサードパーティ製のアプリケーションを活用し、運用アクティビティのビジネス、ワークロード、運用レベルのビューを集約して表示できる。
* AWS では、AWS X-Ray、CloudWatch、CloudTrail、VPC フローログなどのログ機能を通じて、ワークロードのインサイトを提供している。

---

> **OPS 8: ワークロードの正常性はどのように把握するのですか?**
> ワークロードメトリクスの定義、キャプチャ、分析をすると、適切なアクションを取れるようにワークロードイベントの可視性を高めることができます。

---

> **OPS 9: オペレーションの正常性はどのように把握するのですか?**
> オペレーションメトリクスを定義し、キャプチャし、分析することで、オーペレーションイベントの可視性を高め、適切なアクションがとれるようになります。

---

> **OPS 10: ワークロードと運用イベントはどのように管理するのですか?**
> イベントに対応するための手順を準備、検証してワークロードの中断を最小限にします。

##### 進化

* 運用上の優秀性を維持するには、学び、共有し、継続的に改善する必要がある。継続的かつ段階的な改善を行うために専用の作業サイクルを作成する。顧客に影響を与えるすべてのイベントについて、インシデント後の分析を実行する。反復を制限または防止する要因と予防措置を特定する。必要に応じて、影響を受けたコミュニティと貢献要因を伝達する。ワークロードと運用手順の両方について、改善の機会 (機能のリクエスト、問題の修正、コンプライアンス要件など) を定期的に評価し、優先順位を付ける。
* 手順にフィードバックループを取り入れ、改善が必要な分野をすばやく特定し、実際に運用して教訓を学ぶ。

---

* チーム間で学んだ教訓を共有し、その教訓の利点を活用する。学んだ教訓に見られる傾向を分析し、運用のメトリクスに関してチーム間で遡及的分析を行い、改善の機会とその方法を特定する。改善をもたらす変更を実施し、結果を評価して成功の判断を行う。
* AWS では、ログデータを Amazon S3 にエクスポートしたり、ログを直接 Amazon S3 に送信して、長期保存したりできる。
* AWS Glue を使用すると、分析のために Amazon S3 でログデータを検出して準備し、関連するメタデータを AWS AWS Glue Data Catalog に保存できる。
* Amazon Athena は AWS Glue とのネイティブな統合により、ログデータを分析し、標準 SQL を使用してクエリを実行できる。
* Amazon QuickSight のようなビジネスインテリジェンスツールを使用して、データの可視化、調査、分析を行うことができる。

---

> **OPS 11: 運用はどのように進化させるのですか?**
> 漸進的な継続的改善に時間とリソースを費やすことで、オペレーションを効果的かつ効率的に進化させることができます。
